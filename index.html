<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script defer src="https://unpkg.com/p5"></script>
    <script defer src="https://unpkg.com/p5.collide2d"></script>
    <script defer src="https://cdn.rawgit.com/bit101/quicksettings/master/quicksettings.js"></script>
    <script defer src="https://cdn.rawgit.com/bitcraftlab/p5.gui/master/libraries/p5.gui.js"></script>
    <script src="./Dragon.js"></script>
    <script src="./Wall.js"></script>
    <script src="./Ray.js"></script>
    <style> body {padding: 0; margin: 0;} canvas {vertical-align: top;} </style>
</head>

<body>
    <script>
        let params = {
            debug: false
        };
        
        var gui;
        let dragons = []
        let walls = []
        
        function setup() {
            collideDebug(true);
            createCanvas(windowWidth, windowHeight)
            var gui = createGui('Dragon Stats');
            gui.addObject(params);

            walls[0] = new Wall(0, 0, 1000, 0, true)
            walls[1] = new Wall(0, 0, 0.1, 1000, true)
            walls[2] = new Wall(1000, 0, 1000, 1000, true)
            walls[3] = new Wall(0, 1000, 1000, 1000, true)
            for (let i = 0; i < 50; i++) {
                dragons[i] = new Dragon(Math.random()*800 + 100, Math.random()*800 + 100,Math.round(Math.random() * 255),Math.round(Math.random() * 255),Math.round(Math.random() * 255), (Math.random()*Math.PI * 2)- Math.PI) 
            }
        }

        function draw() {
            background(200)
            rectMode(CORNER)
            noStroke()
            fill(175)
            push()
            if (windowWidth > 1200) {
                rect((windowWidth - 1000)/2, 100, 1000,1000)
                translate((windowWidth - 1000)/2, 100)
            } else {
                scale(windowWidth/1200)
                rect(100, 100, 1000,1000)
                translate(100, 100)
            }
            for(let i = 0; i < dragons.length; i++) {
                if (!dragons[i].dead) {
                    dragons[i].action()
                    dragons[i].move()
                    for(let j = 0; j < walls.length; j++) {
                        dragons[i].checkIntercept(walls[j])
                    }
                    dragons[i].draw(params.debug, walls)
                }
            }
            for(let i = 0; i < walls.length; i++) {
                walls[i].draw()
            }
            pop()
        }

        windowResized = function () {
            resizeCanvas(windowWidth, windowHeight);
        };

    </script>
</body>

</html>